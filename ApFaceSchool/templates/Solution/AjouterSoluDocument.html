{% extends base_template %}
{% block content %}
{% load static %}
<div class="container-fluid">
    <div class="row m-3">
        <div class="col-md-8 col-xs-8 col-sm-8 col-lg-8 m-1 table-responsive shadow">
        <center><label for="id_Nom" class="form-label">CLASSE :</label>
              ====<b style="color : red">[ {{ nomclasse.NomClasse }} ]</b>====</center>
            <hr>
              <table class="table table-striped table-bordered">
                  <thead class="table-success">
                    <tr>
                      <th>N°Doc</th>
                      <th>Discipline</th>
                      <th>Type</th>
                      <th>Documents</th>
                      <th>N°Solution</th>
                      <th>Solution</th>
                      <th>Date</th>
                      <th>Auteurs</th>
                     <th>Note</th>
                      <th>Supprimer</th>

                    </tr>
                  </thead>
                  <tbody>
                    {% for doc in   Solution %}
                        <tr>
                          <td scope="row">{{doc.documents_id}}</td>
                          <td>{{doc.Discipline_id}}</td>
                          <td>{{doc.documents.TypeDoc}}</td>
                          <td>
                            <a href="{{ doc.documents.Document.url}}" download>Télécharger</a>
                          </td>
                          <td>{{doc.id}}</td>
                         <td>
                            <a href="{{ doc.Solution.url }}" download>Télécharger Solution</a>
                         </td>
                        <td>{{doc.create_at|date:"d/m/Y"}}</td>
                        <td>{{doc.username}}</td>
                        <td style="color : blue">{% if not doc.Note %}
                                <a class="nav-link text-blue" href="{% url 'Ajouter_Note' doc.id %}">Saisir Note</a>
                            {% else %}
                                 <a class="nav-link text-blue" href="{% url 'Ajouter_Note' doc.id %}">{{ doc.Note }}</a>
                            {% endif %}

                            </td>
                        <td>
                            {% if doc.username_id == request.user.id %}
                             <a class="nav-link text-white" onclick="return confirm('Voulez-vous vraiment supprimer ?')" href="{% url 'SupSolution' doc.id %}"><img width="35%" src="{% static 'images/Logo/corbeille.png' %}" alt="FaceSchool"/></a>
                            {% endif %}
                        </td>

                        </tr>
                    {% endfor %}
                  </tbody>
               </table>

                 <div class="m-3"><button type="button" class=".btn-mini rounded-pill"><a class="nav-link text-blue"  href="{% url 'Ajouter_document' nomclasse.id %}">Mes Documents</a></button></div>

        </div>

        <div class="col-md-3 col-xs-3 col-sm-3 col-lg-3 m-3 shadow">
            <div class="m-3"><center><button  class="btn btn-sm btn-danger"><b>DEPOSER UNE SOLUTION</b></button></center></div>
            <hr>
             <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12 ">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} shadow">{{ message }}</div>
                    {% endfor %}
                {% endif%}
            </div>
            <hr>
           <form method="post" enctype="multipart/form-data">
              {% csrf_token %}

               <div class="mb-1">
                <center>  <label for="id_Nom" class="form-label">SOLUTION N°:</label>
                 <b style="color : red"> [ {{ pk }} ]</b></center>
            </div>
               <hr>
              {{ form.as_p }}
            <center><button type="submit" class="btn btn-primary">Enregistrer</button></center>
           </form>
        </div>

    </div>
</div>

<script>
function validateFileSize(input) {
    const file = input.files[0];
    if (file) {
        const maxSize = 20 * 1024 * 1024; // 20 Mo
        const allowedExtensions = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.png', '.jpeg', '.jpg'];
        const ext = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

        if (file.size > maxSize) {
            alert("⚠️ Le fichier dépasse 20 Mo.");
            input.value = "";
        } else if (!allowedExtensions.includes(ext)) {
            alert("⚠️ Type de fichier non autorisé : " + ext);
            input.value = "";
        }
    }
}
</script>
{% endblock content %}