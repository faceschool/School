{% extends "Menus/Menu.html" %}
{% load static %}
{% block content %}

<div class="container-fluid py-4">

  <!-- ====== Bandeau principal ====== -->
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
    <div class="d-flex align-items-center">
      <img src="https://static.vecteezy.com/ti/vecteur-libre/t1/8292836-dossier-avec-documents-emploi-entreprise-et-finance-embauche-dossier-de-documents-avec-feuilles-de-papier-et-notes-adhesives-illustration-de-dessin-anime-isoler-sur-fond-blanc-vectoriel.jpg"
           alt="Documents"
           class="img-fluid me-3 rounded shadow-sm"
           style="width: 60px; height: auto;">
      <div>
        <h4 class="fw-bold text-primary mb-0">
          Documents : [ {{ type_doc|upper }} ] ‚Äì [ {{ Disc|upper }} ] ‚Äì [ {{ niv }} ]
        </h4>
        <small class="text-muted">Consultez, filtrez et t√©l√©chargez vos documents publics par niveau et discipline.</small>
      </div>
    </div>

    <!-- Barre de recherche -->
    <div class="mt-3 mt-md-0">
      <input type="text" id="searchInput" class="form-control shadow-sm"
             placeholder="üîç Rechercher un document ou une discipline..."
             style="min-width: 300px;">
    </div>
  </div>

  <hr>

  <div class="row g-4">
    <!-- ====== Colonne gauche : Discipline et filtre Niveau ====== -->
    <div class="col-lg-3 col-md-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white text-center fw-bold">
          <i class="bi bi-journal-text me-2"></i>DISCIPLINES
        </div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0" id="disciplineTable">
            <tbody>
              {% for doc in disciple %}
              <tr>
                <td>
                  <a href="{% url 'ListeDocumentPartPublicDisc' type_doc doc.discipline %}"
                     class="text-decoration-none text-dark fw-semibold d-block py-2 px-2">
                    <i class="bi bi-bookmark-fill text-primary me-1"></i>{{ doc.discipline }}
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td class="text-center text-muted py-3">Aucune discipline disponible</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        {% if disciple %}
        <div class="card-footer bg-light">
          <form method="POST" enctype="multipart/form-data"
                action="{% url 'ListeDocumentPartPublicDisc' type_doc Disc %}">
            {% csrf_token %}
            <label for="Niveau" class="form-label fw-bold text-secondary">Niveau :</label>
            <select class="form-select mb-3" name="Niveau" id="Niveau">
              {% for niv in niveau %}
              <option value="{{ niv.niveau }}">{{ niv.niveau }}</option>
              {% endfor %}
            </select>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle me-1"></i> OK
              </button>
            </div>
          </form>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- ====== Colonne droite : Documents ====== -->
    <div class="col-lg-9 col-md-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white text-center fw-bold">
          <i class="bi bi-file-earmark-text me-2"></i>DOCUMENTS PUBLICS
        </div>
        <div class="card-body table-responsive">
          <table class="table table-striped table-bordered align-middle" id="documentsTable">
            <thead class="table-success text-center">
              <tr>
                <th>Discipline</th>
                <th>Niveau</th>
                <th>Titre</th>
                <th>Type</th>
                <th>T√©l√©chargement</th>
              </tr>
            </thead>
            <tbody>
              {% for doc in TypeDocClass %}
              <tr>
                <td>{{ doc.Discipline_id }}</td>
                <td>{{ doc.Niveau }}</td>
                <td>{{ doc.Titre }}</td>
                <td>{{ doc.TypeDoc }}</td>
                <td class="text-center">
                  <a href="{{ doc.Document.url }}" download class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-download"></i> T√©l√©charger
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted py-3">
                  Aucun document disponible pour cette s√©lection.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ====== Bootstrap Icons ====== -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<!-- ====== Filtrage dynamique ====== -->
<script>
  document.getElementById('searchInput').addEventListener('keyup', function () {
    const filter = this.value.toLowerCase();
    const docRows = document.querySelectorAll('#documentsTable tbody tr');
    const discRows = document.querySelectorAll('#disciplineTable tr');

    docRows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });

    discRows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  });
</script>

{% endblock content %}
