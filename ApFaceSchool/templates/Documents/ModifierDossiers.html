{% extends base_template %}
{% block content %}
{% load static %}
<div class="container-fluid">
     <b><img  width="5%" src="https://static.vecteezy.com/ti/vecteur-libre/t1/8292836-dossier-avec-documents-emploi-entreprise-et-finance-embauche-dossier-de-documents-avec-feuilles-de-papier-et-notes-adhesives-illustration-de-dessin-anime-isoler-sur-fond-blanc-vectoriel.jpg" class="img-fluid"   alt="FaceSchool"/>Mes Dossiers</b>
    <hr>
    <div class="row mt-3">
        <div class="col-md-8 col-xs-8 col-sm-8 col-lg-8 m-3 shadow">

               <table class="table table-striped table-bordered m-3">
                 <thead class="table-info">
                    <tr>
                      <th>#</th>
                      <th>Discipline</th>
                        <th>Niveau</th>
                      <th>Titre</th>
                      <th>Type Doc</th>
                         <th>documents</th>
                         <th>Modifier</th>
                         <th>Supprimer</th>

                    </tr>
                  </thead>
                  <tbody>
                    {% for doc in MesDos %}
                        <tr>
                                <td>{{ doc.id }}</td>
                                <td>{{ doc.Discipline_id }}</td>
                                <td>{{ doc.Niveau }}</td>
                                <td>{{ doc.Titre }}</td>
                                <td>{{ doc.TypeDoc }}</td>
                                <td>
                                    {% if doc.Document %}
                                        <a href="{{ doc.Document.url }}" download class="btn btn-outline-primary btn-sm">
                                            Télécharger
                                        </a>
                                    {% endif %}
                                    {% if Types == 'Formateur' %}
                                        <a href="{% url 'Transfert_document' doc.id %}"
                                           class="btn btn-outline-secondary btn-sm">Transférer</a>
                                    {% elif Types == 'Apprenant' %}
                                        <a href="{% url 'Transfert_documentGrpEtude' doc.id %}"
                                           class="btn btn-outline-secondary btn-sm">Transférer</a>
                                    {% endif %}
                                </td>

                                    {% if doc.username_id == request.user.id %}
                                    <td>
                                        <a href="{% url 'Modifier_Dossiers' doc.id %}"
                                           class="btn btn-outline-primary btn-sm">Modifier</a>
                                    </td>
                                     <td>
                                        <a href="{% url 'SupDossiers' doc.id %}"
                                           onclick="return confirm('Voulez-vous vraiment supprimer ce document ?')"
                                           class="btn btn-outline-danger btn-sm">
                                           <i class="bi bi-trash"></i>
                                        </a>
                                    {% endif %}
                                    </td>
                            </tr>
                    {% endfor %}
                  </tbody>
               </table>
        </div>

        <div class="col-md-3 col-xs-3 col-sm-3 col-lg-3 m-3 shadow">
            <div class="m-3"><center><button  class="btn btn-info "><b>MODIFIER LE DOCUMENT</b></button></center></div>

             <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12 ">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} shadow">{{ message }}</div>
                    {% endfor %}
                {% endif%}
            </div>
           <hr>
            <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <div class="d-flex justify-content-end mt-3">
                <a href="{% url 'Ajouter_dossiers' user.id %}" class="btn btn-secondary me-2">Annuler</a>
                <button type="submit" class="btn btn-success">Enregistrer les modifications</button>
            </div>
        </form>
        </div>

    </div>
</div>
<script>
function validateFileSize(input) {
    const file = input.files[0];
    if (file) {
        const maxSize = 20 * 1024 * 1024; // 20 Mo
        const allowedExtensions = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.png', '.jpeg', '.jpg'];
        const ext = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

        if (file.size > maxSize) {
            alert("⚠️ Le fichier dépasse 20 Mo.");
            input.value = "";
        } else if (!allowedExtensions.includes(ext)) {
            alert("⚠️ Type de fichier non autorisé : " + ext);
            input.value = "";
        }
    }
}
</script>


{% endblock content %}