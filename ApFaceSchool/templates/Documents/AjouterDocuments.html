{% extends base_template %}
{% block content %}
{% load static %}
<style>
/* --- Cards et shadows --- */
.card-form {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  padding: 20px;
}
.card-form:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

/* --- Glow champ actif --- */
input:focus, select:focus, textarea:focus {
  outline: none;
  border: 2px solid #0d6efd;
  box-shadow: 0 0 8px rgba(13,110,253,0.5);
  transition: all 0.3s ease;
  background-color: #f8f9fa;
}

/* --- Shake pour champ en erreur --- */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  50% { transform: translateX(4px); }
  75% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}
.field-error {
  animation: shake 0.4s ease;
  border: 2px solid #dc3545 !important;
  background-color: #ffe5e5;
}

/* --- Tableau hover --- */
.table tbody tr:hover {
  background-color: rgba(13,110,253,0.1);
  transform: scale(1.01);
  transition: all 0.2s ease;
}

/* --- Boutons centrés --- */
.btn-center {
  display: block;
  width: 60%;
  margin: 10px auto;
}

/* --- Notification animée --- */
.alert-animate {
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.5s ease;
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  z-index: 1050;
  min-width: 300px;
}
.alert-animate.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}
</style>

<div class="container-fluid">
  <!-- Notification animée -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-animate" id="flash-message">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="row m-3">

    <!-- Tableau des documents -->
    <div class="col-md-8 table-responsive shadow p-3 mb-3 card-form">
      <center>
        <label class="form-label">CLASSE :</label>
        <b style="color: red">[{{ nomclasse.id }} - {{ nomclasse.NomClasse }}]</b>
      </center>
      <hr>
      <table class="table table-striped table-bordered">
        <thead class="table-success">
          <tr>
            <th>Discipline</th>
            <th>Titre</th>
            <th>Type</th>
            <th>Documents</th>
            <th>Solution</th>
            <th>Modifier</th>
            <th>Supprimer</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in DocClass %}
            <tr>
              <td>{{ doc.Discipline }}</td>
              <td>{{ doc.Titre }}</td>
              <td>{{ doc.TypeDoc }}-N°{{ doc.id }}</td>

              <td>
                 {% if doc.Document %}
                    <a href="{{ doc.Document.url }}" download class="btn btn-sm btn-outline-primary">Télécharger</a>
                 {% endif %}
              </td>
              <td>
                {% if doc.TypeDoc != "Cours" %}
                  <center>
                    <a href="{% url 'Ajouter_Solution' doc.id %}">
                      <img width="20%" src="{% static 'images/Logo/plus.png' %}" alt="Ajouter solution"/>
                    </a>
                  </center>
                {% endif %}
              </td>
              <td><a href="{% url 'Modifier_document' doc.id %}" class="btn btn-sm btn-outline-success">Modifier</a></td>
              <td>
                <center>
                  <a onclick="return confirm('Voulez-vous vraiment supprimer ?')" href="{% url 'SupDocuments' doc.id %}" class="btn btn-sm btn-outline-primary">
                    <img width="22%" src="{% static 'images/Logo/corbeille.png' %}" alt="Supprimer"/>
                  </a>
                </center>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="7" class="text-center">Aucun document trouvé.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Formulaire dépôt document -->
    <div class="col-md-3 card-form shadow">
      <div class="card-header bg-primary text-white text-center fw-bold">
        <i class="bi bi-upload me-2"></i>Déposer un Document
      </div>
      <hr>
       {% if messages %}
         {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
         {% endfor %}
       {% endif %}
      <form method="POST" enctype="multipart/form-data" class="p-3 shadow rounded bg-white">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
      </form>
    </div>

  </div>
</div>

<script>
// Notification animée
window.addEventListener('DOMContentLoaded', (event) => {
  const flash = document.getElementById('flash-message');
  if (flash) {
    setTimeout(() => { flash.classList.add('show'); }, 100);
    setTimeout(() => {
      flash.classList.remove('show');
      setTimeout(() => { flash.remove(); }, 500);
    }, 3100);
  }
});

function validateFileSize(input) {
    const file = input.files[0];
    if (file) {
        const maxSize = 20 * 1024 * 1024; // 20MB

        // Vérifie la taille du fichier
        if (file.size > maxSize) {
            alert("⚠️ Le fichier dépasse la taille maximale autorisée (20 Mo).");
            input.value = ""; // Réinitialise le champ
        }

        // Vérifie l'extension (sécurité côté client)
        const allowedExtensions = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.png', '.jpeg', '.jpg'];
        const fileExt = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

        if (!allowedExtensions.includes(fileExt)) {
            alert("⚠️ Type de fichier non autorisé.\nExtensions autorisées : " + allowedExtensions.join(', '));
            input.value = "";
        }
    }
}
</script>




{% endblock content %}