{% extends base_template %}
{% block content %}
{% load static %}
<div class="container-fluid py-3">
  <!-- Header -->
  <div class="d-flex align-items-center mb-3">
    <a class="nav-link text-success fw-bold" href="{% url 'Ajouter_MessagesClasse' request.user.id %}">
      <img src="https://cdn-icons-png.flaticon.com/512/3488/3488196.png" width="30" class="me-2" alt="Messages"/>
      Mes Messages : [{{TotalMessages}}]
    </a>
  </div>
  <hr>

  <div class="row">
    <!-- Colonne Mes Classes -->
    <div class="col-lg-3 col-md-3 col-3 mb-4">

    <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body">

            <h6 class="text-center fw-bold text-success mb-2">
                MES CLASSES
            </h6>
            <hr class="mt-0">

            <ul class="list-group mb-3">
                {% for class in MesClasse %}
                    <li class="list-group-item d-flex justify-content-between align-items-center rounded">
                        <a href="{% url 'Liste_MessagesClasse' class.id %}"
                           class="text-decoration-none fw-semibold text-primary">

                            {{ class.NomClasse }}

                        </a>
                        <span class="badge bg-success rounded-pill">
                            {{ class.id }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
            <!-- Pagination -->
                {% if MesClasse.has_other_pages %}
                <nav class="mt-2">
                    <ul class="pagination justify-content-center">
                        {% if MesClasse.has_previous %}
                            <li class="page-item"><a class="page-link" href="?page={{ MesClasse.previous_page_number }}">Précédent</a></li>
                        {% endif %}
                        {% for num in MesClasse.paginator.page_range %}
                            <li class="page-item {% if MesClasse.number == num %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                        {% endfor %}
                        {% if MesClasse.has_next %}
                            <li class="page-item"><a class="page-link" href="?page={{ MesClasse.next_page_number }}">Suivant</a></li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% if type_doc %}
                <form method="POST" class="p-3 bg-light border rounded-3 shadow-sm">
                    {% csrf_token %}

                    <label class="form-label fw-bold text-secondary">Niveau :</label>

                    <select class="form-select" name="Niveau" id="Niveau">
                        {% for niv in niveau %}
                            <option value="{{ niv.niveau }}">{{ niv.niveau }}</option>
                        {% endfor %}
                    </select>

                    <div class="text-center mt-3">
                        <button type="submit" class="btn btn-success btn-sm px-4">
                            OK
                        </button>
                    </div>
                </form>
            {% endif %}

        </div>
    </div>

</div>


    <!-- Colonne Messages -->
    <div class="col-lg-6 col-md-6 col-6 mb-3 shadow p-1 rounded bg-light table-responsive">
      <center><b class="text-danger">MES MESSAGES</b></center>
      <hr>
      <table class="table table-striped table-bordered">
        <thead class="table-success">
          <tr>
            <th>Objet</th>
            <th>Message</th>
            <th>Classe</th>
            <th>Pièce Jointe</th>
            <th>Date</th>
            <th>Supprimer</th>
          </tr>
        </thead>
        <tbody>
          {% for mess in MessagesClasses %}
            <tr>
              <td>{{mess.Objet}}</td>
              <td>
                <b class="text-success">{{mess.Message|linebreaksbr}}</b>
                <br>[ Auteur : <b>{{mess.username.username}}</b> ]
              </td>
              <td>{{mess.maclasse.NomClasse}} - {{mess.maclasse.id}}</td>
              <td>
                {% if mess.PiecesJointe %}
                  <a href="{{mess.PiecesJointe.url}}" download class="btn btn-sm btn-outline-secondary">Télécharger</a>
                {% endif %}
              </td>
              <td>{{mess.create_at|date:"d/m/Y H:i"}}</td>
              <td>
                {% if mess.username_id == request.user.id %}
                  <a onclick="return confirm('Voulez-vous vraiment supprimer ?')" href="{% url 'Supp_MessagesClasse' mess.id %}">
                      <center><i class="bi bi-trash" ></i></center>

                  </a>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="text-center text-danger">Aucun message disponible</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
        <!-- Pagination -->
                {% if MessagesClasses.has_other_pages %}
                <nav class="mt-2">
                    <ul class="pagination justify-content-center">
                        {% if MessagesClasses.has_previous %}
                            <li class="page-item"><a class="page-link" href="?page={{ MessagesClasses.previous_page_number }}">Précédent</a></li>
                        {% endif %}
                        {% for num in MessagesClasses.paginator.page_range %}
                            <li class="page-item {% if MessagesClasses.number == num %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                        {% endfor %}
                        {% if MessagesClasses.has_next %}
                            <li class="page-item"><a class="page-link" href="?page={{ MessagesClasses.next_page_number }}">Suivant</a></li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
    </div>

    <!-- Colonne Envoyer un message -->
    <div class="col-lg-3 col-md-3 col-12 mb-3 shadow p-3 rounded bg-light">
      <center><button class="btn btn-info mb-2 w-100">ENVOYER UN MESSAGE</button></center>
      <hr>
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} shadow">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="POST" enctype="multipart/form-data" class="p-2 rounded bg-white shadow">
        {% csrf_token %}
        <!-- Classe -->
        <label class="form-label fw-bold">Classe :</label>
        <select class="form-select mb-2" name="Classe" required>
          <option value="">-- Sélectionnez une classe --</option>
          {% for Maclass in MesClasse %}
            <option value="{{Maclass.id}}">{{Maclass.NomClasse}} - {{Maclass.id}}</option>
          {% endfor %}
        </select>

        <!-- Objet -->
        <label class="form-label fw-bold">Objet :</label>
        <input type="text" name="Objet" class="form-control mb-2" placeholder="Votre Objet" required>

        <!-- Message -->
        <label class="form-label fw-bold">Message :</label>
        <textarea name="Message" class="form-control mb-2" rows="4" placeholder="Votre Message..." maxlength="500"></textarea>

        <!-- Pièce Jointe -->
        <label class="form-label fw-bold">Document :</label>
        <input type="file" name="PiecesJointe" class="form-control mb-2">

        <center><button type="submit" class="btn btn-primary w-100">Envoyer</button></center>
      </form>
    </div>
  </div>
</div>



{% endblock content %}