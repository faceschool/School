{% extends "Menus/MenuEspaceApp.html" %}
{% block content %}
{% load static %}

<div class="container-fluid">
  <!-- En-tête -->
  <div class="text-center my-3">
    <h4 class="fw-bold text-danger">
      Classe : [ {{ MClasses.NomClasse }} ]
    </h4>
    <hr class="w-25 mx-auto" />
  </div>

  <!-- Réunions prévues -->
  {% if mesreunions %}
  <div class="row justify-content-center mb-4">
    <div class="col-md-8 shadow rounded bg-light p-3">
      <div class="card-header bg-success text-white text-center fw-bold rounded">
        <i class="bi bi-camera-video-fill me-2"></i> Réunions Google Meet prévues
      </div>

      {% for class in mesclasse %}
      <div class="table-responsive mt-3">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-success text-center">
            <tr>
              <th>Titre</th>
              <th>Description</th>
              <th>Date début</th>
              <th>Date fin</th>
              <th>État</th>
              <th>Lien</th>
            </tr>
          </thead>
          <tbody>
            {% for reunion in mesreunions %}
            {% if class.id == reunion.maclasse_id %}
            <tr>
              <td>{{ reunion.titre }}</td>
              <td>{{ reunion.description }}</td>
              <td>{{ reunion.date_debut|date:"d/m/Y H:i" }}</td>
              <td>{{ reunion.date_fin|date:"d/m/Y H:i" }}</td>
              {% if reunion.etat %}
              <td class="text-danger fw-bold">Terminé</td>
              <td>-</td>
              {% else %}
              <td class="text-primary fw-bold">Prévu</td>
              <td>
                <a
                  href="{{ reunion.meet_link }}"
                  target="_blank"
                  class="btn btn-outline-success btn-sm"
                >
                  <i class="bi bi-camera-video"></i> Rejoindre
                </a>
              </td>
              {% endif %}
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Documents et Messages -->
  <div class="row">
    <!-- Documents Classe -->
    <div class="col-md-6 mb-4">
      <div class="card shadow border-0">
        <div class="card-header bg-primary text-white text-center fw-bold">
          <img
            width="4%"
            src="https://static.vecteezy.com/ti/vecteur-libre/t1/8292836-dossier-avec-documents-emploi-entreprise-et-finance-embauche-dossier-de-documents-avec-feuilles-de-papier-et-notes-adhesives-illustration-de-dessin-anime-isoler-sur-fond-blanc-vectoriel.jpg"
            alt="FaceSchool"
            class="me-2"
          />
          Documents de la classe
        </div>
        <div class="card-body table-responsive">
          {% if mesclasse %}
          <table class="table table-striped table-bordered align-middle">
            <thead class="table-success text-center">
              <tr>
                <th>#</th>
                <th>Discipline</th>
                <th>Niveau</th>
                <th>Titre</th>
                <th>Type</th>
                <th>Document</th>
                <th>Solution</th>
              </tr>
            </thead>
            <tbody>
              {% for doc in DocClass %}
              <tr>
                <td>{{ doc.id }}</td>
                <td>{{ doc.Discipline }}</td>
                <td>{{ doc.Niveau }}</td>
                <td>{{ doc.Titre }}</td>
                <td>{{ doc.TypeDoc }}</td>
                <td>
                  {% if doc.Document %}
                  <a
                    href="{{ doc.Document.url }}"
                    download
                    class="btn btn-outline-primary btn-sm"
                    >Télécharger</a
                  >
                  {% else %}
                  <span class="text-muted">Aucun document</span>
                  {% endif %}
                </td>
                <td>
                  {% if doc.TypeDoc != "Cours" %}
                  <a
                    href="{% url 'Ajouter_Solution' doc.id %}"
                    class="btn btn-outline-success btn-sm"
                    title="Ajouter une solution"
                  >
                    <i class="bi bi-plus-circle"></i>
                  </a>
                  {% endif %}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted">
                  Aucun document trouvé.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Infos Classe + Liste Apprenants -->
    <div class="col-md-6 mb-4">
      <div class="row">
        <!-- Messages de la classe -->
        <div class="col-md-8 mb-3">
          <div class="card shadow border-0">
            <div class="card-header bg-success text-white text-center fw-bold">
              Infos de la classe
            </div>
            <div class="card-body table-responsive">
              <table class="table table-striped table-bordered align-middle">
                <thead class="table-success text-center">
                  <tr>
                    <th>Date</th>
                    <th>Objet</th>
                    <th>Message</th>
                  </tr>
                </thead>
                <tbody>
                  {% for mess in MessagesClasses %}
                  <tr>
                    <td>{{ mess.create_at|date:"d/m/Y H:i" }}</td>
                    <td>{{ mess.Objet }}</td>
                    <td>
                      {{ mess.Message|linebreaksbr }}
                      {% if mess.PiecesJointe %}
                      <br />
                      <strong>Pièce jointe :</strong>
                      <a
                        href="{{ mess.PiecesJointe.url }}"
                        download
                        class="text-decoration-none text-primary"
                        >Télécharger</a
                      >
                      {% endif %}
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="3" class="text-center text-muted">
                      Aucun message pour cette classe.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Liste des apprenants -->
        <div class="col-md-4">
          {% if Appren %}
          <div class="card shadow border-0">
            <div class="card-header bg-primary text-white text-center fw-bold">
              Apprenants de la classe
            </div>
            <div class="card-body p-2" style="max-height: 500px; overflow-y: auto;">
              {% for Liste in Appren %}
              <div class="border rounded p-2 mb-2 text-center">
                {% if Liste.Photo %}
                <img
                  src="{{ Liste.Photo.url }}"
                  alt="Photo"
                  class="img-fluid rounded mb-2"
                  style="max-height: 100px;"
                />
                {% endif %}
                <p class="fw-bold mb-1">
                  {{ Liste.Nom }} {{ Liste.Prenom }}
                </p>
                <small>
                  <b>Tel:</b> {{ Liste.Tel }} <br />
                  <b>Email:</b> {{ Liste.Email }}
                </small>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}